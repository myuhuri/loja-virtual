<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dior Imports</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <div class="header-container">
            <div class="login-container">
                <div class="user-greeting" id="userGreeting" style="display: none;"></div>
                <button id="loginButton" class="btn login-button">Login</button>
                <button id="logoutButton" class="btn logout-button" style="display: none;">Logout</button>
            </div>
            <div class="search-container">
                <input type="text" placeholder="Pesquisar produtos..." id="search" onkeyup="searchProducts()">
            </div>
            <nav class="categories">
                <ul>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle">Maquiagem</a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Batom</a></li>
                            <li><a href="#">Paleta de Sombras</a></li>
                            <li><a href="#">Base</a></li>
                            <li><a href="#">Máscara de Cílios</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle">Feminino</a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Perfumes</a></li>
                            <li><a href="#">Cremes</a></li>
                            <li><a href="#">Tratamentos</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle">Masculino</a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Perfumes</a></li>
                            <li><a href="#">Gel de Banho</a></li>
                            <li><a href="#">Cuidados com a Barba</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle">Cadastro</a>
                        <ul class="dropdown-menu">
                            <li><a href="#" id="clientes-button">Clientes</a></li>
                            <li><a href="#" id="produtos-button">Produtos</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
            <div class="store-name">
                <h1>Dior Imports</h1>
            </div>
            <div class="cart-container">
                <a href="#" id="cartLink" class="cart-button">
                    <img src="https://img.icons8.com/material-outlined/24/000000/shopping-cart.png" alt="Carrinho">
                    <span class="cart-count" id="cartCount">0</span>
                </a>
            </div>

            <div class="mode-toggle-container">
                <button id="toggle-mode" class="btn">
                    <img id="mode-icon" src="https://img.icons8.com/ios-filled/24/000000/sun.png" alt="Modo Claro">
                </button>
            </div>
        </div>
    </header>

    <!-- Seção principal (alterna entre loja e carrinho) -->
    <main id="mainContent">
        <!-- Conteúdo da Loja -->
        <section id="storeContent">
            <section class="featured-products">
                <h2>Mais Vendidos</h2>
                <div class="products">
                    <div class="product" data-id="1">
                        <img src="https://lojadior.vtexassets.com/arquivos/ids/196323-1200-800/3348901321129_02-highlight-sauvage-edt.jpg?v=638786829193270000" alt="Sauvage Eau de Toilette">
                        <h3>Sauvage</h3>
                        <p class="price">R$ 1225,00</p>
                        <p class="description">Um perfume robusto e elegante, perfeito para o dia a dia.</p>
                        <div class="product-actions">
                            <button class="btn add-to-cart">Adicionar ao Carrinho</button>
                            <a href="https://shop.dior.com.br/sauvage-eau-de-parfum/p?skuId=64" class="btn view-more">Ver Mais</a>
                        </div>
                    </div>
                    <div class="product" data-id="2">
                        <img src="https://lojadior.vtexassets.com/arquivos/ids/200427-1200-800/3348901571432_02-highlight-md-edp.jpg?v=638836058392300000" alt="Miss Dior">
                        <h3>Miss Dior</h3>
                        <p class="price">R$ 1039,00</p>
                        <p class="description">Delicado e sofisticado, ideal para ocasiões especiais.</p>
                        <div class="product-actions">
                            <button class="btn add-to-cart">Adicionar ao Carrinho</button>
                            <a href="https://shop.dior.com.br/new-miss-dior-eau-de-parfum/p?skuId=798" class="btn view-more">Ver Mais</a>
                        </div>
                    </div>
                    <div class="product" data-id="3">
                        <img src="https://lojadior.vtexassets.com/arquivos/ids/198944-1200-800/3348901738224_02-highlight-jadore.jpg?v=638799843681300000" alt="J'adore">
                        <h3>J'adore</h3>
                        <p class="price">R$ 1039,00</p>
                        <p class="description">Elegância atemporal, um clássico da perfumaria.</p>
                        <div class="product-actions">
                            <button class="btn add-to-cart">Adicionar ao Carrinho</button>
                            <a href="https://shop.dior.com.br/jadore-eau-de-parfum/p?skuId=2511" class="btn view-more">Ver Mais</a>
                        </div>
                    </div>
                    <div class="product" data-id="4">
                        <img src="https://lojadior.vtexassets.com/arquivos/ids/200457-1200-800/3348901627375_02-highlight-md-bb.jpg?v=638836058911570000" alt="Miss Dior Blooming Bouquet">
                        <h3>MissDior Blooming Bouquet</h3>
                        <p class="price">R$ 915,00</p>
                        <p class="description">Flores frescas e suaves, um perfume delicado para o verão.</p>
                        <div class="product-actions">
                            <button class="btn add-to-cart">Adicionar ao Carrinho</button>
                            <a href="https://shop.dior.com.br/miss-dior-blooming-bouquet/p?skuId=1543" class="btn view-more">Ver Mais</a>
                        </div>
                    </div>
                </div>
            </section>

            <section class="other-products">
                <h2>Outros Produtos</h2>
                <div class="products">
                    <div class="product" data-id="5">
                        <img src="https://lojadior.vtexassets.com/arquivos/ids/199149-1200-800/3348900378551_02-highlight-poison.jpg.jpg?v=638799921511700000" alt="Hypnotic Poison">
                        <h3>Hypnotic Poison</h3>
                        <p class="price">R$ 915,00</p>
                        <p class="description">Um perfume oriental arrebatador, incrivelmente sensual.</p>
                        <button class="btn add-to-cart">Adicionar ao Carrinho</button>
                    </div>
                    <div class="product" data-id="6">
                        <img src="https://lojadior.vtexassets.com/arquivos/ids/199166-1200-800/3348901654395_02-highlight-LCP.jpg.jpg?v=638802484923500000" alt="Gris Dior">
                        <h3>Gris Dior</h3>
                        <p class="price">R$ 3.199,00</p>
                        <p class="description">Faz uma declaração forte e reconhecível, sempre com elegância.</p>
                        <button class="btn add-to-cart">Adicionar ao Carrinho</button>
                    </div>
                </div>
            </section>
        </section>

        <!-- Conteúdo do Carrinho (inicialmente oculto) -->
        <section id="cartContent" style="display: none;">
            <div class="cart-header">
                <button id="backToStore" class="btn back-button">Voltar para a Loja</button>
                <h2>Carrinho de Compras</h2>
            </div>

            <section class="cart-items">
                <div id="cartItemsContainer">
                    <!-- Itens serão inseridos aqui via JavaScript -->
                </div>
            </section>

            <section class="cart-summary">
                <div class="coupon-container">
                    <input type="text" id="couponCode" placeholder="Código de desconto">
                    <button id="applyCoupon" class="btn">Aplicar</button>
                </div>
                <div class="summary-details">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">R$ 0,00</span>
                    </div>
                    <div class="summary-row" id="discountRow" style="display: none;">
                        <span>Desconto:</span>
                        <span id="discount">-R$ 0,00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="total">R$ 0,00</span>
                    </div>
                    <button id="checkoutButton" class="btn checkout">Finalizar Compra</button>
                </div>
            </section>
        </section>
    </main>

    <!-- POPUP DE LOGIN -->
    <div id="loginPopup" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>Login</h2>
            <form id="loginForm">
                <input type="email" id="email" placeholder="E-mail" required>
                <input type="password" id="password" placeholder="Senha" required>
                <button type="submit" class="btn solid">Entrar</button>
                <button type="button" id="recover-password-button" class="btn clear">Recuperar Senha</button>
                <button type="button" id="register-button" class="btn">Cadastrar</button>
            </form>
        </div>
    </div>

    <!-- POPUP DE CADASTRO DE CLIENTES -->
    <div id="clientesPopup" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>Cadastro de Clientes</h2>
            <form id="clientesForm">
                <input type="text" id="nomeCliente" placeholder="Nome completo" required>
                <input type="text" id="cpfCliente" placeholder="CPF" required>
                <input type="text" id="enderecoCliente" placeholder="Endereço" required>
                <input type="tel" id="telefoneCliente" placeholder="Telefone" required>
                <button type="submit" class="btn solid">Cadastrar Cliente</button>
            </form>
        </div>
    </div>

    <!-- POPUP DE CADASTRO DE PRODUTOS -->
    <div id="produtosPopup" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>Cadastro de Produtos</h2>
            <form id="produtosForm">
                <input type="text" id="nomeProduto" placeholder="Nome do produto" required>
                <input type="text" id="idProduto" placeholder="ID do produto" required>
                <input type="text" id="categoriaProduto" placeholder="Categoria" required>
                <button type="submit" class="btn solid">Cadastrar Produto</button>
            </form>
        </div>
    </div>

    <!-- POPUP DE ITEM ADICIONADO -->
    <div id="addedToCartPopup" class="modal temporary-popup">
        <div class="modal-content">
            <div class="popup-icon">✓</div>
            <h2>Item Adicionado!</h2>
            <p>O produto foi adicionado ao seu carrinho.</p>
        </div>
    </div>

    <!-- POPUP DE DESCONTO -->
    <div id="discountPopup" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="popup-icon">🎁</div>
            <h2>Cupom de Desconto!</h2>
            <p>Use o código <strong>THAEMILLY25</strong> para obter 10% de desconto em sua compra!</p>
            <button class="btn solid close-modal">Ótimo, obrigado!</button>
        </div>
    </div>

    <!-- POPUP DE DESCONTO APLICADO -->
    <div id="discountAppliedPopup" class="modal temporary-popup">
        <div class="modal-content">
            <div class="popup-icon">✓</div>
            <h2>Desconto Aplicado!</h2>
            <p>Seu cupom de desconto foi aplicado com sucesso.</p>
        </div>
    </div>

    <!-- POPUP DE PEDIDO REALIZADO -->
    <div id="orderCompletedPopup" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="popup-icon">✓</div>
            <h2>Pedido Realizado!</h2>
            <p>Obrigado por comprar na Dior Imports. Seu pedido foi processado com sucesso.</p>
            <button class="btn solid close-modal">Fechar</button>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="social-media">
                <a href="https://www.instagram.com/thaemiillly/?hl=pt-br" class="social-icon">Instagram</a>
                <a href="https://tiktok.com" class="social-icon">TikTok</a>
            </div>
            <div class="contact">
                <p>Contato: thaemillyoliveira@acad.ifma.edu.br</p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBGH_p7RXKwwOvyxuK3TXIlV6qxfSi5tjM",
            authDomain: "dior-imports.firebaseapp.com",
            projectId: "dior-imports",
            storageBucket: "dior-imports.appspot.com",
            messagingSenderId: "927899020114",
            appId: "1:927899020114:web:eba5b8dd55f0e62796288b"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        const loginButton = document.getElementById('loginButton');
        const logoutButton = document.getElementById('logoutButton');
        const userGreeting = document.getElementById('userGreeting');
        
        // Elementos do modal
        const modals = document.querySelectorAll('.modal');
        const closeButtons = document.querySelectorAll('.close-modal');
        
        // Elementos do cadastro
        const clientesButton = document.getElementById('clientes-button');
        const produtosButton = document.getElementById('produtos-button');
        const clientesForm = document.getElementById('clientesForm');
        const produtosForm = document.getElementById('produtosForm');

        // Carrinho de compras
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let discount = 0;
        const DISCOUNT_CODE = 'THAEMILLY25';
        const DISCOUNT_PERCENTAGE = 0.1; // 10%

        // Verificar e aplicar modo salvo
        function applySavedMode() {
            const savedMode = localStorage.getItem('mode');
            const modeIcon = document.getElementById('mode-icon');
            
            if (savedMode === 'light') {
                document.body.classList.add('light-mode');
                modeIcon.src = 'https://img.icons8.com/ios-filled/24/000000/sun.png';
            } else {
                document.body.classList.remove('light-mode');
                modeIcon.src = 'https://img.icons8.com/ios-filled/24/000000/moon.png';
            }
        }

        // Atualizar contador do carrinho
        function updateCartCount() {
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
        }

        // Mostrar modal
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // Fechar modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Fechar todos os modais
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            document.body.style.overflow = 'auto';
        }

        // Alternar modo claro/escuro (ícones corrigidos)
        document.getElementById('toggle-mode').addEventListener('click', () => {
            const modeIcon = document.getElementById('mode-icon');
            
            if (document.body.classList.contains('light-mode')) {
                document.body.classList.remove('light-mode');
                modeIcon.src = 'https://img.icons8.com/ios-filled/24/000000/moon.png';
                localStorage.setItem('mode', 'dark');
            } else {
                document.body.classList.add('light-mode');
                modeIcon.src = 'https://img.icons8.com/ios-filled/24/000000/sun.png';
                localStorage.setItem('mode', 'light');
            }
        });

        // Formatar valor para exibição
        function formatCurrency(value) {
            return 'R$ ' + value.toFixed(2).replace('.', ',');
        }

        // Renderizar itens do carrinho
        function renderCartItems() {
            const container = document.getElementById('cartItemsContainer');
            container.innerHTML = '';

            if (cart.length === 0) {
                container.innerHTML = '<p class="empty-cart">Seu carrinho está vazio</p>';
                updateTotals();
                return;
            }

            cart.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'cart-item';
                itemElement.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <div class="cart-item-info">
                        <h3>${item.name}</h3>
                        <p class="price">${formatCurrency(item.price)}</p>
                        <div class="quantity-controls">
                            <button class="btn quantity-btn minus" data-index="${index}">-</button>
                            <span class="quantity">${item.quantity}</span>
                            <button class="btn quantity-btn plus" data-index="${index}">+</button>
                        </div>
                        <button class="btn remove-item" data-index="${index}">Remover</button>
                    </div>
                `;
                container.appendChild(itemElement);
            });

            // Adicionar event listeners
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    cart.splice(index, 1);
                    saveCart();
                });
            });

            document.querySelectorAll('.quantity-btn.minus').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    if (cart[index].quantity > 1) {
                        cart[index].quantity -= 1;
                    } else {
                        cart.splice(index, 1);
                        // Se o carrinho ficar vazio, remove o desconto
                        if (cart.length === 0) {
                            discount = 0;
                            document.getElementById('couponCode').value = '';
                        }
                    }
                    saveCart();
                });
            });

            document.querySelectorAll('.quantity-btn.plus').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    cart[index].quantity += 1;
                    saveCart();
                });
            });

            updateTotals();
        }

        // Atualizar totais
        function updateTotals() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const discountValue = subtotal * discount;
            const total = subtotal - discountValue;

            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('total').textContent = formatCurrency(total);

            const discountRow = document.getElementById('discountRow');
            if (discount > 0) {
                discountRow.style.display = 'flex';
                document.getElementById('discount').textContent = '-' + formatCurrency(discountValue);
            } else {
                discountRow.style.display = 'none';
            }
        }

        // Salvar carrinho no localStorage
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            renderCartItems();
        }

        // Aplicar cupom de desconto
        document.getElementById('applyCoupon').addEventListener('click', function() {
            const couponCode = document.getElementById('couponCode').value.trim();
            if (couponCode === DISCOUNT_CODE) {
                discount = DISCOUNT_PERCENTAGE;
                updateTotals();
                showModal('discountAppliedPopup');
                setTimeout(() => {
                    closeModal('discountAppliedPopup');
                }, 1000);
            } else if (couponCode === '') {
                discount = 0;
                updateTotals();
                alert('Cupom removido.');
            } else {
                discount = 0;
                updateTotals();
                alert('Cupom inválido.');
            }
        });

        // Alternar entre loja e carrinho
        function toggleCartView(showCart) {
            if (showCart) {
                document.getElementById('storeContent').style.display = 'none';
                document.getElementById('cartContent').style.display = 'block';
                document.querySelector('nav.categories').style.display = 'none';
                renderCartItems();
            } else {
                document.getElementById('storeContent').style.display = 'block';
                document.getElementById('cartContent').style.display = 'none';
                document.querySelector('nav.categories').style.display = 'block';
            }
        }

        // Adicionar ao carrinho
        document.querySelectorAll('.add-to-cart').forEach(button => {
            button.addEventListener('click', function() {
                const productElement = this.closest('.product');
                const product = {
                    id: productElement.dataset.id,
                    name: productElement.querySelector('h3').textContent,
                    price: parseFloat(productElement.querySelector('.price').textContent.replace('R$ ', '').replace('.', '').replace(',', '.')),
                    image: productElement.querySelector('img').src,
                    quantity: 1
                };

                const existingItem = cart.find(item => item.id === product.id);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push(product);
                }

                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
                
                // Mostrar popup de item adicionado
                showModal('addedToCartPopup');
                
                // Fechar automaticamente após 2 segundos
                setTimeout(() => {
                    closeModal('addedToCartPopup');
                }, 1000);
                
                // Mostrar popup de desconto aleatoriamente (20% de chance)
                if (Math.random() < 0.2) {
                    setTimeout(() => {
                        showModal('discountPopup');
                    }, 1500);
                }
            });
        });

        // Event listeners para modais
        closeButtons.forEach(button => {
            button.addEventListener('click', closeAllModals);
        });

        // Fechar modal quando clicar fora
        window.addEventListener('click', (event) => {
            if (event.target.classList.contains('modal')) {
                closeAllModals();
            }
        });

        // Link do carrinho no cabeçalho
        document.getElementById('cartLink').addEventListener('click', function(e) {
            e.preventDefault();
            toggleCartView(true);
        });

        // Botão voltar para a loja
        document.getElementById('backToStore').addEventListener('click', function() {
            toggleCartView(false);
        });

        // Inicializar contador do carrinho
        updateCartCount();

        // Dropdown menus
        document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
            toggle.addEventListener('click', function(e) {
                e.preventDefault();
                const menu = this.nextElementSibling;
                const isOpen = menu.style.display === 'block';
                
                // Fecha todos os outros menus
                document.querySelectorAll('.dropdown-menu').forEach(m => {
                    if (m !== menu) m.style.display = 'none';
                });
                
                // Abre/fecha o menu atual
                menu.style.display = isOpen ? 'none' : 'block';
            });
        });

        // Fecha menus quando clicar fora
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    menu.style.display = 'none';
                });
            }
        });

        // Login e cadastro
        loginButton.addEventListener('click', () => showModal('loginPopup'));
        clientesButton.addEventListener('click', (e) => {
            e.preventDefault();
            showModal('clientesPopup');
        });
        produtosButton.addEventListener('click', (e) => {
            e.preventDefault();
            showModal('produtosPopup');
        });

        clientesForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const nome = document.getElementById('nomeCliente').value;
            const cpf = document.getElementById('cpfCliente').value;
            const endereco = document.getElementById('enderecoCliente').value;
            const telefone = document.getElementById('telefoneCliente').value;
            
            database.ref('clientes').push({
                nome: nome,
                cpf: cpf,
                endereco: endereco,
                telefone: telefone,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                alert('Cliente cadastrado com sucesso!');
                clientesForm.reset();
                closeModal('clientesPopup');
            }).catch((error) => {
                alert('Erro ao cadastrar cliente: ' + error.message);
            });
        });

        produtosForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const nome = document.getElementById('nomeProduto').value;
            const idProduto = document.getElementById('idProduto').value;
            const categoria = document.getElementById('categoriaProduto').value;
            
            database.ref('produtos').push({
                nome: nome,
                idProduto: idProduto,
                categoria: categoria,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                alert('Produto cadastrado com sucesso!');
                produtosForm.reset();
                closeModal('produtosPopup');
            }).catch((error) => {
                alert('Erro ao cadastrar produto: ' + error.message);
            });
        });

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    closeModal('loginPopup');
                    document.getElementById('loginForm').reset();
                })
                .catch((error) => {
                    alert(error.message);
                });
        });

        document.getElementById('register-button').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            if (!email || !password) {
                alert('Por favor, preencha todos os campos para se registrar.');
                return;
            }
            auth.createUserWithEmailAndPassword(email, password)
                .then(() => {
                    alert('Conta criada com sucesso!');
                    closeModal('loginPopup');
                    document.getElementById('loginForm').reset();
                })
                .catch((error) => {
                    alert(error.message);
                });
        });

        document.getElementById('recover-password-button').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            if (!email) {
                alert('Por favor, insira seu e-mail para recuperar a senha.');
                return;
            }
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    alert('E-mail de recuperação enviado! Verifique sua caixa de entrada.');
                })
                .catch((error) => {
                    alert(error.message);
                });
        });

        logoutButton.addEventListener('click', () => {
            auth.signOut();
        });

        // Finalizar compra
        document.getElementById('checkoutButton').addEventListener('click', function() {
            if (cart.length === 0) {
                alert('Seu carrinho está vazio!');
                return;
            }
            
            // Mostrar popup de pedido realizado
            showModal('orderCompletedPopup');
            
            // Limpar carrinho
            cart = [];
            discount = 0;
            localStorage.removeItem('cart');
            saveCart();
            
            // Voltar para a loja após 3 segundos
            setTimeout(() => {
                closeAllModals();
                toggleCartView(false);
            }, 3000);
        });

        auth.onAuthStateChanged((user) => {
            if (user) {
                loginButton.style.display = 'none';
                logoutButton.style.display = 'block';
                userGreeting.style.display = 'block';
                userGreeting.textContent = `Olá, ${user.email.split('@')[0]}`;
            } else {
                loginButton.style.display = 'block';
                logoutButton.style.display = 'none';
                userGreeting.style.display = 'none';
            }
        });

        // Aplicar modo salvo ao carregar a página
        applySavedMode();

        // Função de pesquisa
        function searchProducts() {
            const input = document.getElementById('search').value.toLowerCase();
            const allProducts = document.querySelectorAll('.product');

            allProducts.forEach(product => {
                const title = product.querySelector('h3').textContent.toLowerCase();
                const description = product.querySelector('.description')?.textContent.toLowerCase() || '';

                if (title.includes(input) || description.includes(input)) {
                    product.style.display = 'block';
                } else {
                    product.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>