<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dior Imports</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <div class="header-container">
            <div class="login-container">
                <div class="user-greeting" id="userGreeting" style="display: none;"></div>
                <button id="loginButton" class="btn login-button">Login</button>
                <button id="logoutButton" class="btn logout-button" style="display: none;">Logout</button>
            </div>
            <div class="search-container">
                <input type="text" placeholder="Pesquisar produtos..." id="search" onkeyup="searchProducts()">
            </div>
            <div class="store-name">
                <h1>Dior Imports</h1>
            </div>
            <div class="cart-container">
                <a href="#" id="cartLink" class="cart-button">
                    <img src="https://img.icons8.com/material-outlined/24/000000/shopping-cart.png" alt="Carrinho">
                    <span class="cart-count" id="cartCount">0</span>
                </a>
            </div>
            <div class="mode-toggle-container">
                <button id="toggle-mode" class="btn">
                    <img id="mode-icon" src="https://img.icons8.com/ios-filled/24/000000/sun.png" alt="Modo Claro">
                </button>
            </div>
            <nav class="categories">
                <ul>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle">Maquiagem</a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Batom</a></li>
                            <li><a href="#">Paleta de Sombras</a></li>
                            <li><a href="#">Base</a></li>
                            <li><a href="#">M√°scara de C√≠lios</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle">Feminino</a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Perfumes</a></li>
                            <li><a href="#">Cremes</a></li>
                            <li><a href="#">Tratamentos</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle">Masculino</a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Perfumes</a></li>
                            <li><a href="#">Gel de Banho</a></li>
                            <li><a href="#">Cuidados com a Barba</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle">Cadastro</a>
                        <ul class="dropdown-menu">
                            <li><a href="#" id="clientes-button">Clientes</a></li>
                            <li><a href="#" id="produtos-button">Produtos</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Se√ß√£o principal (alterna entre loja e carrinho) -->
    <main id="mainContent">
        <!-- Conte√∫do da Loja -->
        <section id="storeContent">
            <section class="featured-products">
                <h2>Produtos</h2>
                <div class="products" id="productsContainer">
                    <!-- Produtos ser√£o carregados dinamicamente aqui -->
                </div>
            </section>
        </section>

        <!-- Conte√∫do do Carrinho (inicialmente oculto) -->
        <section id="cartContent" style="display: none;">
            <div class="cart-header">
                <button id="backToStore" class="btn back-button">Voltar para a Loja</button>
                <h2>Carrinho de Compras</h2>
            </div>

            <section class="cart-items">
                <div id="cartItemsContainer">
                    <!-- Itens ser√£o inseridos aqui via JavaScript -->
                </div>
            </section>

            <section class="cart-summary">
                <div class="coupon-container">
                    <input type="text" id="couponCode" placeholder="C√≥digo de desconto">
                    <button id="applyCoupon" class="btn">Aplicar</button>
                </div>
                <div class="summary-details">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">R$ 0,00</span>
                    </div>
                    <div class="summary-row" id="discountRow" style="display: none;">
                        <span>Desconto:</span>
                        <span id="discount">-R$ 0,00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="total">R$ 0,00</span>
                    </div>
                    <button id="checkoutButton" class="btn checkout">Finalizar Compra</button>
                </div>
            </section>
        </section>
    </main>

    <!-- POPUP DE LOGIN -->
    <div id="loginPopup" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>Login</h2>
            <form id="loginForm">
                <input type="email" id="email" placeholder="E-mail" required>
                <input type="password" id="password" placeholder="Senha" required>
                <button type="submit" class="btn solid">Entrar</button>
                <button type="button" id="recover-password-button" class="btn clear">Recuperar Senha</button>
                <button type="button" id="register-button" class="btn">Cadastrar</button>
            </form>
        </div>
    </div>

    <!-- POPUP DE CADASTRO DE CLIENTES -->
    <div id="clientesPopup" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>Cadastro de Clientes</h2>
            <form id="clientesForm">
                <input type="hidden" id="clienteKey">
                <input type="text" id="nomeCliente" placeholder="Nome completo" required>
                <input type="text" id="cpfCliente" placeholder="CPF" required>
                <input type="email" id="emailCliente" placeholder="E-mail" required>
                <input type="text" id="enderecoCliente" placeholder="Endere√ßo" required>
                <input type="tel" id="telefoneCliente" placeholder="Telefone" required>
                <div class="form-buttons">
                    <button type="submit" class="btn solid">Salvar</button>
                    <button type="button" id="cancelarCliente" class="btn clear">Cancelar</button>
                </div>
            </form>
            <div class="clientes-list-container">
                <h3>Clientes Cadastrados</h3>
                <div class="search-container">
                    <input type="text" id="searchClientes" placeholder="Pesquisar clientes..." onkeyup="searchClientes()">
                </div>
                <div id="clientesList" class="clientes-list">
                    <!-- Lista de clientes ser√° carregada aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- POPUP DE CADASTRO DE PRODUTOS -->
    <div id="produtosPopup" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>Cadastro de Produtos</h2>
            <form id="produtosForm">
                <input type="hidden" id="produtoKey">
                <input type="text" id="nomeProduto" placeholder="Nome do produto" required>
                <input type="text" id="idProduto" placeholder="ID do produto" required>
                <input type="number" id="precoProduto" placeholder="Pre√ßo" step="0.01" required>
                <input type="text" id="categoriaProduto" placeholder="Categoria" required>
                <input type="text" id="descricaoProduto" placeholder="Descri√ß√£o">
                <input type="text" id="imagemProduto" placeholder="URL da imagem">
                <div class="form-buttons">
                    <button type="submit" class="btn solid">Salvar</button>
                    <button type="button" id="cancelarProduto" class="btn clear">Cancelar</button>
                </div>
            </form>
            <div class="produtos-list-container">
                <h3>Produtos Cadastrados</h3>
                <div class="search-container">
                    <input type="text" id="searchProdutos" placeholder="Pesquisar produtos..." onkeyup="searchProdutos()">
                </div>
                <div id="produtosList" class="produtos-list">
                    <!-- Lista de produtos ser√° carregada aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- POPUP DE ITEM ADICIONADO -->
    <div id="addedToCartPopup" class="modal temporary-popup">
        <div class="modal-content">
            <div class="popup-icon">‚úì</div>
            <h2>Item Adicionado!</h2>
            <p>O produto foi adicionado ao seu carrinho.</p>
        </div>
    </div>

    <!-- POPUP DE DESCONTO -->
    <div id="discountPopup" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="popup-icon">üéÅ</div>
            <h2>Cupom de Desconto!</h2>
            <p>Use o c√≥digo <strong>THAEMILLY25</strong> para obter 10% de desconto em sua compra!</p>
            <button class="btn solid close-modal">√ìtimo, obrigado!</button>
        </div>
    </div>

    <!-- POPUP DE DESCONTO APLICADO -->
    <div id="discountAppliedPopup" class="modal temporary-popup">
        <div class="modal-content">
            <div class="popup-icon">‚úì</div>
            <h2>Desconto Aplicado!</h2>
            <p>Seu cupom de desconto foi aplicado com sucesso.</p>
        </div>
    </div>

    <!-- POPUP DE PEDIDO REALIZADO -->
    <div id="orderCompletedPopup" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="popup-icon">‚úì</div>
            <h2>Pedido Realizado!</h2>
            <p>Obrigado por comprar na Dior Imports. Seu pedido foi processado com sucesso.</p>
            <button class="btn solid close-modal">Fechar</button>
        </div>
    </div>

    <!-- POPUP DE CONFIRMA√á√ÉO DE EXCLUS√ÉO DE CLIENTE -->
    <div id="confirmDeleteClientePopup" class="modal confirmation-popup">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="popup-icon">‚ö†Ô∏è</div>
            <h2>Confirmar Exclus√£o</h2>
            <p>Tem certeza que deseja excluir este cliente?</p>
            <div class="popup-buttons">
                <button class="btn confirm" id="confirmDeleteCliente">Excluir</button>
                <button class="btn cancel close-modal">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- POPUP DE CONFIRMA√á√ÉO DE EXCLUS√ÉO DE PRODUTO -->
    <div id="confirmDeleteProdutoPopup" class="modal confirmation-popup">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="popup-icon">‚ö†Ô∏è</div>
            <h2>Confirmar Exclus√£o</h2>
            <p>Tem certeza que deseja excluir este produto?</p>
            <div class="popup-buttons">
                <button class="btn confirm" id="confirmDeleteProduto">Excluir</button>
                <button class="btn cancel close-modal">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- POPUP DE SUCESSO AO SALVAR CLIENTE -->
    <div id="successClientePopup" class="modal temporary-popup">
        <div class="modal-content">
            <div class="popup-icon">‚úì</div>
            <h2>Sucesso!</h2>
            <p id="successClienteMessage">Cliente salvo com sucesso!</p>
        </div>
    </div>

    <!-- POPUP DE SUCESSO AO SALVAR PRODUTO -->
    <div id="successProdutoPopup" class="modal temporary-popup">
        <div class="modal-content">
            <div class="popup-icon">‚úì</div>
            <h2>Sucesso!</h2>
            <p id="successProdutoMessage">Produto salvo com sucesso!</p>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="social-media">
                <a href="https://www.instagram.com/thaemiillly/?hl=pt-br" class="social-icon">Instagram</a>
                <a href="https://tiktok.com" class="social-icon">TikTok</a>
            </div>
            <div class="contact">
                <p>Contato: thaemillyoliveira@acad.ifma.edu.br</p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBGH_p7RXKwwOvyxuK3TXIlV6qxfSi5tjM",
            authDomain: "dior-imports.firebaseapp.com",
            projectId: "dior-imports",
            storageBucket: "dior-imports.appspot.com",
            messagingSenderId: "927899020114",
            appId: "1:927899020114:web:eba5b8dd55f0e62796288b"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        const loginButton = document.getElementById('loginButton');
        const logoutButton = document.getElementById('logoutButton');
        const userGreeting = document.getElementById('userGreeting');
        
        // Elementos do modal
        const modals = document.querySelectorAll('.modal');
        const closeButtons = document.querySelectorAll('.close-modal');
        
        // Elementos do cadastro
        const clientesButton = document.getElementById('clientes-button');
        const produtosButton = document.getElementById('produtos-button');
        const clientesForm = document.getElementById('clientesForm');
        const produtosForm = document.getElementById('produtosForm');

        // Carrinho de compras
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let discount = 0;
        const DISCOUNT_CODE = 'THAEMILLY25';
        const DISCOUNT_PERCENTAGE = 0.1; // 10%

        // Vari√°veis para controle de exclus√£o
        let clienteToDelete = null;
        let produtoToDelete = null;

        // Verificar e aplicar modo salvo
        function applySavedMode() {
            const savedMode = localStorage.getItem('mode');
            const modeIcon = document.getElementById('mode-icon');
            
            if (savedMode === 'light') {
                document.body.classList.add('light-mode');
                modeIcon.src = 'https://img.icons8.com/ios-filled/24/000000/sun.png';
            } else {
                document.body.classList.remove('light-mode');
                modeIcon.src = 'https://img.icons8.com/ios-filled/24/000000/moon.png';
            }
        }

        // Atualizar contador do carrinho
        function updateCartCount() {
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
        }

        // Mostrar modal
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Carregar dados quando o modal √© aberto
            if (modalId === 'clientesPopup') {
                loadClientes();
            } else if (modalId === 'produtosPopup') {
                loadProdutos();
            }
        }

        // Fechar modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // Limpar formul√°rios quando o modal √© fechado
            if (modalId === 'clientesPopup') {
                clientesForm.reset();
                document.getElementById('clienteKey').value = '';
            } else if (modalId === 'produtosPopup') {
                produtosForm.reset();
                document.getElementById('produtoKey').value = '';
            }
        }

        // Fechar todos os modais
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            document.body.style.overflow = 'auto';
            
            // Limpar formul√°rios
            clientesForm.reset();
            produtosForm.reset();
            document.getElementById('clienteKey').value = '';
            document.getElementById('produtoKey').value = '';
        }

        // Alternar modo claro/escuro
        document.getElementById('toggle-mode').addEventListener('click', () => {
            const modeIcon = document.getElementById('mode-icon');
            
            if (document.body.classList.contains('light-mode')) {
                document.body.classList.remove('light-mode');
                modeIcon.src = 'https://img.icons8.com/ios-filled/24/000000/moon.png';
                localStorage.setItem('mode', 'dark');
            } else {
                document.body.classList.add('light-mode');
                modeIcon.src = 'https://img.icons8.com/ios-filled/24/000000/sun.png';
                localStorage.setItem('mode', 'light');
            }
        });

        // Formatar valor para exibi√ß√£o
        function formatCurrency(value) {
            return 'R$ ' + value.toFixed(2).replace('.', ',');
        }

        // Renderizar itens do carrinho
        function renderCartItems() {
            const container = document.getElementById('cartItemsContainer');
            container.innerHTML = '';

            if (cart.length === 0) {
                container.innerHTML = '<p class="empty-cart">Seu carrinho est√° vazio</p>';
                updateTotals();
                return;
            }

            cart.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'cart-item';
                itemElement.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <div class="cart-item-info">
                        <h3>${item.name}</h3>
                        <p class="price">${formatCurrency(item.price)}</p>
                        <div class="quantity-controls">
                            <button class="btn quantity-btn minus" data-index="${index}">-</button>
                            <span class="quantity">${item.quantity}</span>
                            <button class="btn quantity-btn plus" data-index="${index}">+</button>
                        </div>
                        <button class="btn remove-item" data-index="${index}">Remover</button>
                    </div>
                `;
                container.appendChild(itemElement);
            });

            // Adicionar event listeners
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    cart.splice(index, 1);
                    saveCart();
                });
            });

            document.querySelectorAll('.quantity-btn.minus').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    if (cart[index].quantity > 1) {
                        cart[index].quantity -= 1;
                    } else {
                        cart.splice(index, 1);
                        // Se o carrinho ficar vazio, remove o desconto
                        if (cart.length === 0) {
                            discount = 0;
                            document.getElementById('couponCode').value = '';
                        }
                    }
                    saveCart();
                });
            });

            document.querySelectorAll('.quantity-btn.plus').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    cart[index].quantity += 1;
                    saveCart();
                });
            });

            updateTotals();
        }

        // Atualizar totais
        function updateTotals() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const discountValue = subtotal * discount;
            const total = subtotal - discountValue;

            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('total').textContent = formatCurrency(total);

            const discountRow = document.getElementById('discountRow');
            if (discount > 0) {
                discountRow.style.display = 'flex';
                document.getElementById('discount').textContent = '-' + formatCurrency(discountValue);
            } else {
                discountRow.style.display = 'none';
            }
        }

        // Salvar carrinho no localStorage
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            renderCartItems();
        }

        // Aplicar cupom de desconto
        document.getElementById('applyCoupon').addEventListener('click', function() {
            const couponCode = document.getElementById('couponCode').value.trim();
            if (couponCode === DISCOUNT_CODE) {
                discount = DISCOUNT_PERCENTAGE;
                updateTotals();
                showModal('discountAppliedPopup');
                setTimeout(() => {
                    closeModal('discountAppliedPopup');
                }, 1000);
            } else if (couponCode === '') {
                discount = 0;
                updateTotals();
                showSuccessMessage('Cupom removido.');
            } else {
                discount = 0;
                updateTotals();
                showSuccessMessage('Cupom inv√°lido.');
            }
        });

        // Mostrar mensagem de sucesso
        function showSuccessMessage(message) {
            const successMessage = document.createElement('div');
            successMessage.className = 'temporary-message';
            successMessage.textContent = message;
            successMessage.style.position = 'fixed';
            successMessage.style.bottom = '20px';
            successMessage.style.left = '50%';
            successMessage.style.transform = 'translateX(-50%)';
            successMessage.style.backgroundColor = '#40615a';
            successMessage.style.color = 'white';
            successMessage.style.padding = '10px 20px';
            successMessage.style.borderRadius = '8px';
            successMessage.style.zIndex = '9999';
            successMessage.style.animation = 'fadeIn 0.3s, fadeOut 0.3s 2s forwards';
            
            document.body.appendChild(successMessage);
            
            setTimeout(() => {
                successMessage.remove();
            }, 2000);
        }

        // Alternar entre loja e carrinho
        function toggleCartView(showCart) {
            if (showCart) {
                document.getElementById('storeContent').style.display = 'none';
                document.getElementById('cartContent').style.display = 'block';
                document.querySelector('nav.categories').style.display = 'none';
                renderCartItems();
            } else {
                document.getElementById('storeContent').style.display = 'block';
                document.getElementById('cartContent').style.display = 'none';
                document.querySelector('nav.categories').style.display = 'block';
            }
        }

        // Link do carrinho no cabe√ßalho
        document.getElementById('cartLink').addEventListener('click', function(e) {
            e.preventDefault();
            toggleCartView(true);
        });

        // Bot√£o voltar para a loja
        document.getElementById('backToStore').addEventListener('click', function() {
            toggleCartView(false);
        });

        // Inicializar contador do carrinho
        updateCartCount();

        // Dropdown menus
        document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
            toggle.addEventListener('click', function(e) {
                e.preventDefault();
                const menu = this.nextElementSibling;
                const isOpen = menu.style.display === 'block';
                
                // Fecha todos os outros menus
                document.querySelectorAll('.dropdown-menu').forEach(m => {
                    if (m !== menu) m.style.display = 'none';
                });
                
                // Abre/fecha o menu atual
                menu.style.display = isOpen ? 'none' : 'block';
            });
        });

        // Fecha menus quando clicar fora
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    menu.style.display = 'none';
                });
            }
        });

        // Login e cadastro
        loginButton.addEventListener('click', () => showModal('loginPopup'));
        clientesButton.addEventListener('click', (e) => {
            e.preventDefault();
            showModal('clientesPopup');
        });
        produtosButton.addEventListener('click', (e) => {
            e.preventDefault();
            showModal('produtosPopup');
        });

        // Cancelar cadastro de cliente
        document.getElementById('cancelarCliente').addEventListener('click', () => {
            clientesForm.reset();
            document.getElementById('clienteKey').value = '';
        });

        // Cancelar cadastro de produto
        document.getElementById('cancelarProduto').addEventListener('click', () => {
            produtosForm.reset();
            document.getElementById('produtoKey').value = '';
        });

        // Formul√°rio de clientes
        clientesForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const key = document.getElementById('clienteKey').value;
            const cliente = {
                nome: document.getElementById('nomeCliente').value,
                cpf: document.getElementById('cpfCliente').value,
                email: document.getElementById('emailCliente').value,
                endereco: document.getElementById('enderecoCliente').value,
                telefone: document.getElementById('telefoneCliente').value,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            if (key) {
                // Atualizar cliente existente
                database.ref('clientes/' + key).update(cliente)
                    .then(() => {
                        document.getElementById('successClienteMessage').textContent = 'Cliente atualizado com sucesso!';
                        showModal('successClientePopup');
                        setTimeout(() => {
                            closeModal('successClientePopup');
                        }, 1000);
                        clientesForm.reset();
                        document.getElementById('clienteKey').value = '';
                        loadClientes();
                    })
                    .catch((error) => {
                        showSuccessMessage('Erro ao atualizar cliente: ' + error.message);
                    });
            } else {
                // Criar novo cliente
                database.ref('clientes').push(cliente)
                    .then(() => {
                        document.getElementById('successClienteMessage').textContent = 'Cliente cadastrado com sucesso!';
                        showModal('successClientePopup');
                        setTimeout(() => {
                            closeModal('successClientePopup');
                        }, 1000);
                        clientesForm.reset();
                        loadClientes();
                    })
                    .catch((error) => {
                        showSuccessMessage('Erro ao cadastrar cliente: ' + error.message);
                    });
            }
        });

        // Formul√°rio de produtos
        produtosForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const key = document.getElementById('produtoKey').value;
            const produto = {
                nome: document.getElementById('nomeProduto').value,
                idProduto: document.getElementById('idProduto').value,
                preco: parseFloat(document.getElementById('precoProduto').value),
                categoria: document.getElementById('categoriaProduto').value,
                descricao: document.getElementById('descricaoProduto').value,
                imagem: document.getElementById('imagemProduto').value,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            if (key) {
                // Atualizar produto existente
                database.ref('produtos/' + key).update(produto)
                    .then(() => {
                        document.getElementById('successProdutoMessage').textContent = 'Produto atualizado com sucesso!';
                        showModal('successProdutoPopup');
                        setTimeout(() => {
                            closeModal('successProdutoPopup');
                        }, 1000);
                        produtosForm.reset();
                        document.getElementById('produtoKey').value = '';
                        loadProdutos();
                    })
                    .catch((error) => {
                        showSuccessMessage('Erro ao atualizar produto: ' + error.message);
                    });
            } else {
                // Criar novo produto
                database.ref('produtos').push(produto)
                    .then(() => {
                        document.getElementById('successProdutoMessage').textContent = 'Produto cadastrado com sucesso!';
                        showModal('successProdutoPopup');
                        setTimeout(() => {
                            closeModal('successProdutoPopup');
                        }, 1000);
                        produtosForm.reset();
                        loadProdutos();
                    })
                    .catch((error) => {
                        showSuccessMessage('Erro ao cadastrar produto: ' + error.message);
                    });
            }
        });

        // Carregar clientes
        function loadClientes() {
            const clientesList = document.getElementById('clientesList');
            clientesList.innerHTML = '<p>Carregando clientes...</p>';

            database.ref('clientes').once('value', (snapshot) => {
                clientesList.innerHTML = '';
                
                if (!snapshot.exists()) {
                    clientesList.innerHTML = '<p>Nenhum cliente cadastrado.</p>';
                    return;
                }

                snapshot.forEach((childSnapshot) => {
                    const cliente = childSnapshot.val();
                    const clienteElement = document.createElement('div');
                    clienteElement.className = 'cliente-item';
                    clienteElement.innerHTML = `
                        <div class="cliente-info">
                            <h4>${cliente.nome}</h4>
                            <p>CPF: ${cliente.cpf}</p>
                            <p>E-mail: ${cliente.email}</p>
                            <p>Telefone: ${cliente.telefone}</p>
                        </div>
                        <div class="cliente-actions">
                            <button class="btn edit-cliente" data-key="${childSnapshot.key}">Editar</button>
                            <button class="btn delete-cliente" data-key="${childSnapshot.key}">Excluir</button>
                        </div>
                    `;
                    clientesList.appendChild(clienteElement);
                });

                // Adicionar event listeners para edi√ß√£o
                document.querySelectorAll('.edit-cliente').forEach(button => {
                    button.addEventListener('click', function() {
                        const key = this.dataset.key;
                        database.ref('clientes/' + key).once('value', (snapshot) => {
                            const cliente = snapshot.val();
                            document.getElementById('clienteKey').value = key;
                            document.getElementById('nomeCliente').value = cliente.nome;
                            document.getElementById('cpfCliente').value = cliente.cpf;
                            document.getElementById('emailCliente').value = cliente.email;
                            document.getElementById('enderecoCliente').value = cliente.endereco;
                            document.getElementById('telefoneCliente').value = cliente.telefone;
                        });
                    });
                });

                // Adicionar event listeners para exclus√£o
                document.querySelectorAll('.delete-cliente').forEach(button => {
                    button.addEventListener('click', function() {
                        clienteToDelete = this.dataset.key;
                        showModal('confirmDeleteClientePopup');
                    });
                });
            });
        }

        // Carregar produtos
        function loadProdutos() {
            const produtosList = document.getElementById('produtosList');
            produtosList.innerHTML = '<p>Carregando produtos...</p>';

            database.ref('produtos').once('value', (snapshot) => {
                produtosList.innerHTML = '';
                
                if (!snapshot.exists()) {
                    produtosList.innerHTML = '<p>Nenhum produto cadastrado.</p>';
                    return;
                }

                snapshot.forEach((childSnapshot) => {
                    const produto = childSnapshot.val();
                    const produtoElement = document.createElement('div');
                    produtoElement.className = 'produto-item';
                    produtoElement.innerHTML = `
                        <div class="produto-info">
                            <h4>${produto.nome}</h4>
                            <p>ID: ${produto.idProduto}</p>
                            <p>Pre√ßo: ${formatCurrency(produto.preco)}</p>
                            <p>Categoria: ${produto.categoria}</p>
                        </div>
                        <div class="produto-actions">
                            <button class="btn edit-produto" data-key="${childSnapshot.key}">Editar</button>
                            <button class="btn delete-produto" data-key="${childSnapshot.key}">Excluir</button>
                        </div>
                    `;
                    produtosList.appendChild(produtoElement);
                });

                // Adicionar event listeners para edi√ß√£o
                document.querySelectorAll('.edit-produto').forEach(button => {
                    button.addEventListener('click', function() {
                        const key = this.dataset.key;
                        database.ref('produtos/' + key).once('value', (snapshot) => {
                            const produto = snapshot.val();
                            document.getElementById('produtoKey').value = key;
                            document.getElementById('nomeProduto').value = produto.nome;
                            document.getElementById('idProduto').value = produto.idProduto;
                            document.getElementById('precoProduto').value = produto.preco;
                            document.getElementById('categoriaProduto').value = produto.categoria;
                            document.getElementById('descricaoProduto').value = produto.descricao || '';
                            document.getElementById('imagemProduto').value = produto.imagem || '';
                        });
                    });
                });

                // Adicionar event listeners para exclus√£o
                document.querySelectorAll('.delete-produto').forEach(button => {
                    button.addEventListener('click', function() {
                        produtoToDelete = this.dataset.key;
                        showModal('confirmDeleteProdutoPopup');
                    });
                });
            });
        }

        // Confirmar exclus√£o de cliente
        document.getElementById('confirmDeleteCliente').addEventListener('click', function() {
            if (clienteToDelete) {
                database.ref('clientes/' + clienteToDelete).remove()
                    .then(() => {
                        showSuccessMessage('Cliente exclu√≠do com sucesso!');
                        closeModal('confirmDeleteClientePopup');
                        loadClientes();
                    })
                    .catch((error) => {
                        showSuccessMessage('Erro ao excluir cliente: ' + error.message);
                    });
            }
            clienteToDelete = null;
        });

        // Confirmar exclus√£o de produto
        document.getElementById('confirmDeleteProduto').addEventListener('click', function() {
            if (produtoToDelete) {
                database.ref('produtos/' + produtoToDelete).remove()
                    .then(() => {
                        showSuccessMessage('Produto exclu√≠do com sucesso!');
                        closeModal('confirmDeleteProdutoPopup');
                        loadProdutos();
                    })
                    .catch((error) => {
                        showSuccessMessage('Erro ao excluir produto: ' + error.message);
                    });
            }
            produtoToDelete = null;
        });

        // Carregar produtos na loja
        function loadStoreProducts() {
            const productsContainer = document.getElementById('productsContainer');
            productsContainer.innerHTML = '<p>Carregando produtos...</p>';

            database.ref('produtos').once('value', (snapshot) => {
                productsContainer.innerHTML = '';
                
                if (!snapshot.exists()) {
                    productsContainer.innerHTML = '<p>Nenhum produto dispon√≠vel.</p>';
                    return;
                }

                snapshot.forEach((childSnapshot) => {
                    const produto = childSnapshot.val();
                    const productElement = document.createElement('div');
                    productElement.className = 'product';
                    productElement.dataset.id = produto.idProduto;
                    productElement.innerHTML = `
                        <img src="${produto.imagem || 'https://via.placeholder.com/300'}" alt="${produto.nome}">
                        <h3>${produto.nome}</h3>
                        <p class="price">${formatCurrency(produto.preco)}</p>
                        <p class="description">${produto.descricao || 'Descri√ß√£o n√£o dispon√≠vel'}</p>
                        <button class="btn add-to-cart">Adicionar ao Carrinho</button>
                    `;
                    productsContainer.appendChild(productElement);
                });

                // Adicionar event listeners para adicionar ao carrinho
                document.querySelectorAll('.add-to-cart').forEach(button => {
                    button.addEventListener('click', function() {
                        const productElement = this.closest('.product');
                        const product = {
                            id: productElement.dataset.id,
                            name: productElement.querySelector('h3').textContent,
                            price: parseFloat(productElement.querySelector('.price').textContent.replace('R$ ', '').replace('.', '').replace(',', '.')),
                            image: productElement.querySelector('img').src,
                            quantity: 1
                        };

                        const existingItem = cart.find(item => item.id === product.id);
                        if (existingItem) {
                            existingItem.quantity += 1;
                        } else {
                            cart.push(product);
                        }

                        saveCart();
                        
                        // Mostrar popup de item adicionado
                        showModal('addedToCartPopup');
                        
                        // Fechar automaticamente ap√≥s 1 segundo
                        setTimeout(() => {
                            closeModal('addedToCartPopup');
                        }, 1000);
                    });
                });
            });
        }

        // Pesquisar clientes
        function searchClientes() {
            const searchTerm = document.getElementById('searchClientes').value.toLowerCase();
            const clientesItems = document.querySelectorAll('.cliente-item');

            clientesItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Pesquisar produtos
        function searchProdutos() {
            const searchTerm = document.getElementById('searchProdutos').value.toLowerCase();
            const produtosItems = document.querySelectorAll('.produto-item');

            produtosItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Pesquisar produtos na loja
        function searchProducts() {
            const input = document.getElementById('search').value.toLowerCase();
            const allProducts = document.querySelectorAll('.product');

            allProducts.forEach(product => {
                const title = product.querySelector('h3').textContent.toLowerCase();
                const description = product.querySelector('.description')?.textContent.toLowerCase() || '';

                if (title.includes(input) || description.includes(input)) {
                    product.style.display = 'block';
                } else {
                    product.style.display = 'none';
                }
            });
        }

        // Login
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    closeModal('loginPopup');
                    document.getElementById('loginForm').reset();
                })
                .catch((error) => {
                    showSuccessMessage(error.message);
                });
        });

        // Registrar
        document.getElementById('register-button').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            if (!email || !password) {
                showSuccessMessage('Por favor, preencha todos os campos para se registrar.');
                return;
            }
            auth.createUserWithEmailAndPassword(email, password)
                .then(() => {
                    showSuccessMessage('Conta criada com sucesso!');
                    closeModal('loginPopup');
                    document.getElementById('loginForm').reset();
                })
                .catch((error) => {
                    showSuccessMessage(error.message);
                });
        });

        // Recuperar senha
        document.getElementById('recover-password-button').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            if (!email) {
                showSuccessMessage('Por favor, insira seu e-mail para recuperar a senha.');
                return;
            }
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showSuccessMessage('E-mail de recupera√ß√£o enviado! Verifique sua caixa de entrada.');
                })
                .catch((error) => {
                    showSuccessMessage(error.message);
                });
        });

        // Logout
        logoutButton.addEventListener('click', () => {
            auth.signOut();
        });

        // Finalizar compra
        document.getElementById('checkoutButton').addEventListener('click', function() {
            if (cart.length === 0) {
                showSuccessMessage('Seu carrinho est√° vazio!');
                return;
            }
            
            // Mostrar popup de pedido realizado
            showModal('orderCompletedPopup');
            
            // Limpar carrinho
            cart = [];
            discount = 0;
            localStorage.removeItem('cart');
            saveCart();
            
            // Voltar para a loja ap√≥s 3 segundos
            setTimeout(() => {
                closeAllModals();
                toggleCartView(false);
            }, 3000);
        });

        // Verificar estado de autentica√ß√£o
        auth.onAuthStateChanged((user) => {
            if (user) {
                loginButton.style.display = 'none';
                logoutButton.style.display = 'block';
                userGreeting.style.display = 'block';
                userGreeting.textContent = `Ol√°, ${user.email.split('@')[0]}`;
            } else {
                loginButton.style.display = 'block';
                logoutButton.style.display = 'none';
                userGreeting.style.display = 'none';
            }
        });

        // Aplicar modo salvo ao carregar a p√°gina
        applySavedMode();

        // Carregar produtos da loja quando a p√°gina carregar
        window.addEventListener('DOMContentLoaded', () => {
            loadStoreProducts();
        });

        // Event listeners para modais
        closeButtons.forEach(button => {
            button.addEventListener('click', function() {
                const modal = this.closest('.modal');
                closeModal(modal.id);
            });
        });

        // Fechar modal quando clicar fora
        window.addEventListener('click', (event) => {
            if (event.target.classList.contains('modal')) {
                closeModal(event.target.id);
            }
        });

        // Mostrar popup de desconto ap√≥s 5 segundos
        setTimeout(() => {
            if (cart.length > 0 && discount === 0) {
                showModal('discountPopup');
            }
        }, 5000);
    </script>
</body>
</html>