<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrinho de Compras - Dior Imports</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="header-container">
            <a href="index.html" class="back-button">Voltar para a Loja</a>
            <h1>Carrinho de Compras</h1>
            <div class="cart-container">
                <a href="carrinho.html" class="cart-button">
                    <img src="https://img.icons8.com/material-outlined/24/000000/shopping-cart.png" alt="Carrinho">
                    <span class="cart-count" id="cartCount">0</span>
                </a>
            </div>
        </div>
    </header>

    <section class="cart-items">
        <div id="cartItemsContainer">
            <!-- Itens serão inseridos aqui via JavaScript -->
        </div>
    </section>

    <section class="cart-summary">
        <div class="coupon-container">
            <input type="text" id="couponCode" placeholder="Código de desconto">
            <button id="applyCoupon" class="btn">Aplicar</button>
        </div>
        <div class="summary-details">
            <div class="summary-row">
                <span>Subtotal:</span>
                <span id="subtotal">R$ 0,00</span>
            </div>
            <div class="summary-row" id="discountRow" style="display: none;">
                <span>Desconto:</span>
                <span id="discount">-R$ 0,00</span>
            </div>
            <div class="summary-row total">
                <span>Total:</span>
                <span id="total">R$ 0,00</span>
            </div>
            <button id="checkoutButton" class="btn checkout">Finalizar Compra</button>
        </div>
    </section>

    <!-- POPUP DE PEDIDO REALIZADO -->
    <div id="orderCompletedPopup" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="popup-icon">✓</div>
            <h2>Pedido Realizado!</h2>
            <p>Obrigado por comprar na Dior Imports. Seu pedido foi processado com sucesso.</p>
            <button class="btn solid close-modal">Fechar</button>
        </div>
    </div>

    <script>
        // Recuperar carrinho do localStorage
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let discount = 0;
        const DISCOUNT_CODE = 'THAEMILLY25';
        const DISCOUNT_PERCENTAGE = 0.1; // 10%

        // Atualizar contador do carrinho
        function updateCartCount() {
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
        }

        // Formatar valor para exibição
        function formatCurrency(value) {
            return 'R$ ' + value.toFixed(2).replace('.', ',');
        }

        // Mostrar modal
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // Fechar modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Fechar todos os modais
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            document.body.style.overflow = 'auto';
        }

        // Event listeners para modais
        document.querySelectorAll('.close-modal').forEach(button => {
            button.addEventListener('click', closeAllModals);
        });

        // Fechar modal quando clicar fora
        window.addEventListener('click', (event) => {
            if (event.target.classList.contains('modal')) {
                closeAllModals();
            }
        });

        // Renderizar itens do carrinho
        function renderCartItems() {
            const container = document.getElementById('cartItemsContainer');
            container.innerHTML = '';

            if (cart.length === 0) {
                container.innerHTML = '<p class="empty-cart">Seu carrinho está vazio</p>';
                updateTotals();
                return;
            }

            cart.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'cart-item';
                itemElement.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <div class="cart-item-info">
                        <h3>${item.name}</h3>
                        <p class="price">${formatCurrency(item.price)}</p>
                        <div class="quantity-controls">
                            <button class="btn quantity-btn minus" data-index="${index}">-</button>
                            <span class="quantity">${item.quantity}</span>
                            <button class="btn quantity-btn plus" data-index="${index}">+</button>
                        </div>
                        <button class="btn remove-item" data-index="${index}">Remover</button>
                    </div>
                `;
                container.appendChild(itemElement);
            });

            // Adicionar event listeners
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    cart.splice(index, 1);
                    saveCart();
                });
            });

            document.querySelectorAll('.quantity-btn.minus').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    if (cart[index].quantity > 1) {
                        cart[index].quantity -= 1;
                    } else {
                        cart.splice(index, 1);
                        // Se o carrinho ficar vazio, remove o desconto
                        if (cart.length === 0) {
                            discount = 0;
                            document.getElementById('couponCode').value = '';
                        }
                    }
                    saveCart();
                });
            });

            document.querySelectorAll('.quantity-btn.plus').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    cart[index].quantity += 1;
                    saveCart();
                });
            });

            updateTotals();
        }

        // Atualizar totais
        function updateTotals() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const discountValue = subtotal * discount;
            const total = subtotal - discountValue;

            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('total').textContent = formatCurrency(total);

            const discountRow = document.getElementById('discountRow');
            if (discount > 0) {
                discountRow.style.display = 'flex';
                document.getElementById('discount').textContent = '-' + formatCurrency(discountValue);
            } else {
                discountRow.style.display = 'none';
            }
        }

        // Salvar carrinho no localStorage
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            renderCartItems();
        }

        // Aplicar cupom de desconto
        document.getElementById('applyCoupon').addEventListener('click', function() {
            const couponCode = document.getElementById('couponCode').value.trim();
            if (couponCode === DISCOUNT_CODE) {
                discount = DISCOUNT_PERCENTAGE;
                updateTotals();
                alert('Cupom aplicado com sucesso! 10% de desconto.');
            } else if (couponCode === '') {
                discount = 0;
                updateTotals();
                alert('Cupom removido.');
            } else {
                discount = 0;
                updateTotals();
                alert('Cupom inválido.');
            }
        });

        // Finalizar compra
        document.getElementById('checkoutButton').addEventListener('click', function() {
            if (cart.length === 0) {
                alert('Seu carrinho está vazio!');
                return;
            }
            
            // Mostrar popup de pedido realizado
            showModal('orderCompletedPopup');
            
            // Limpar carrinho
            cart = [];
            discount = 0;
            localStorage.removeItem('cart');
            saveCart();
        });

        // Inicializar
        updateCartCount();
        renderCartItems();
    </script>
</body>
</html>